<!DOCTYPE html>
<html>
    <!-- title -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Eric">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Eric">
    <meta name="keywords" content="Eric's Blog | Eric">
    <meta name="description" content="">
    <meta name="Cache-Control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>MongoDB基础 · EricYeee&#39;s documents</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s 1;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= /css/style.css?v=20180524 as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= /css/mobile.css?v=20180524 media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
        
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >EricYeee&#39;s documents</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">MongoDB基础</a>
            </div>
    </div>
    
    <a class="home-link" href=/>EricYeee's documents</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style=








height:50vh;

>
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            MongoDB基础
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "NodeJS">NodeJS</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "MongoDB">MongoDB</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count">4,543</span> / Reading time: <span class="post-count">18 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2018/05/12</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
  
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="MongoDB基础"><a href="#MongoDB基础" class="headerlink" title="MongoDB基础"></a>MongoDB基础</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="丰富的数据模型"><a href="#丰富的数据模型" class="headerlink" title="丰富的数据模型"></a>丰富的数据模型</h3><p><code>MongoDB</code>是<strong>面向文档</strong>的数据库，不是关系型数据库。放弃关系模型的主要原因就是为了获得更加方便的扩展性。面向文档的方式<strong>可以将文档或者数组内嵌进来</strong>，所以用一条记录就可以表示非常复杂的层次关系。</p>
<h3 id="容易扩展"><a href="#容易扩展" class="headerlink" title="容易扩展"></a>容易扩展</h3><h3 id="丰富的功能"><a href="#丰富的功能" class="headerlink" title="丰富的功能"></a>丰富的功能</h3><ul>
<li>索引：<code>MongoDB</code>支持通用辅助索引，能进行多种快速查询；</li>
<li>存储<code>JavaScript</code> ：开发人员不必使用存储过程了，可以直接在服务端存取<code>JavaScript</code> 的函数和值；</li>
<li>聚合</li>
<li>固定集合：集合的大小是有上限的；</li>
<li>文件存储：<code>MongoDB</code>支持用一种容易使用的协议存储大型文件和文件的元数据；</li>
</ul>
<h3 id="不牺牲速度"><a href="#不牺牲速度" class="headerlink" title="不牺牲速度"></a>不牺牲速度</h3><h3 id="便捷的管理"><a href="#便捷的管理" class="headerlink" title="便捷的管理"></a>便捷的管理</h3><p><code>MongoDB</code>尽量让服务器自治来简化数据库的管理。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>文档是<code>MongoDB</code>的核心概念。多个键及其关联的值有序地放置在一起便是文档。</p>
<p>在JavaScript里面，文档表示为对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"greeting"</span> : <span class="string">"Hello, world!"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>文档的几个概念：</p>
<ul>
<li>文档中的键/值对是<strong>有序</strong>的；</li>
<li>文档中的值不仅可以是在双引号里边的字符串，还可以是其他几种数据类型；</li>
<li><code>MongoDB</code> 文档<strong>不但区分类型，还区分大小写，同时不能有重复的键</strong>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"foo"</span> : <span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="string">"foo"</span> : <span class="string">"3"</span>&#125;</span><br><span class="line"><span class="comment">//以上两个文档是不同的</span></span><br><span class="line">&#123;<span class="string">"foo"</span> : <span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="string">"Foo"</span> : <span class="number">3</span>&#125;</span><br><span class="line"><span class="comment">//以上两个文档也是不同的</span></span><br><span class="line">&#123;<span class="string">"greeting"</span> : <span class="string">"Hello, world!"</span>, <span class="string">"greeting"</span>: <span class="string">"Hello, MongoDB!"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>集合就是一组<strong>文档</strong> 。如果说<code>MongoDB</code> 中的文档是类似于关系型数据库中的行，那么<strong>集合就如同表</strong>。</p>
<h4 id="无模式"><a href="#无模式" class="headerlink" title="无模式"></a>无模式</h4><p>集合是<strong>无模式</strong>的。这意味着一个集合里面的文档可以是各式各样的。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"greeting"</span> : <span class="string">"Hello, world!"</span>&#125;</span><br><span class="line">&#123;<span class="string">"foo"</span> : <span class="number">5</span>&#125;</span><br><span class="line"><span class="comment">//两个文档不仅是值得类型不相同，他们的键也是完全不一样的</span></span><br></pre></td></tr></table></figure>
<h4 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h4><p>我们可以通过名字来标识集合</p>
<h5 id="子集合"><a href="#子集合" class="headerlink" title="子集合"></a>子集合</h5><p>组织集合的一种惯例是使用<code>.</code> 字符分开的按命名空间划分的子集合。例如，一个带有博客功能的应用可能包括两个集合，分别是<code>blog.posts</code>和<code>blog.authors</code> 。这样做的目的只是为了使组织结构更好些，也就是说<code>blog</code> 这个集合(<strong>这里根本不需要存在</strong>)及其子集合没有任何关系。</p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p><code>MongoDB</code> 中多个文档组成集合，同样<strong>多个集合可以组成数据库</strong>。一个<code>MongoDB</code> 实例可以承载多个数据库，它们之间可视为完全独立的。</p>
<p><strong>注意</strong>：数据库名最终会变成文件系统里的文件，所以在命名规范上将会有一些额外的限制。</p>
<h3 id="MongoDB-shell"><a href="#MongoDB-shell" class="headerlink" title="MongoDB shell"></a>MongoDB shell</h3><p><code>MongoDB</code> 自带一个<code>JavaScript shell</code> ，可以从命令行与<code>MongoDB</code> 实例交互。</p>
<h4 id="MongoDB客户端"><a href="#MongoDB客户端" class="headerlink" title="MongoDB客户端"></a>MongoDB客户端</h4><p><code>shell</code> 真正的威力在于它是一个独立的<code>MongoDB</code> 客户端。开启时，<code>shell</code> 会连接到<code>MongoDB</code> 服务器的<code>test</code>数据库，并将这个数据库连接赋值给全局变量<code>db</code> 。这个变量是通过<code>shell</code>访问<code>MongoDB</code> 的主要入口点。</p>
<h4 id="shell中的基本操作"><a href="#shell中的基本操作" class="headerlink" title="shell中的基本操作"></a>shell中的基本操作</h4><p>在<code>shell</code>查看操作数据会用到4个基本操作：创建、读取、更新和删除。</p>
<h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><p><code>insert</code>函数将会添加一个文档到集合中。例如，加入要存储一篇博客文章。首先，创建一个局部变量<code>post</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post = &#123;</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"My Blog Post"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"Here's my blog post"</span>,</span><br><span class="line">    <span class="string">"date"</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个对象是个有效的<code>MongoDB</code> 文档，所以可以用insert方法将其保存到<code>blog</code>集合中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.blog.insert(post);</span><br><span class="line"><span class="comment">//验证是否已经完成存储，可以用以下函数查看</span></span><br><span class="line">db.blog.find();</span><br></pre></td></tr></table></figure>
<h5 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h5><p><code>find</code>会返回集合里面的所有文档。若只是想查看一个文档，我们可以用<code>findOne</code>。</p>
<h5 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h5><p>如果要更改博客文章，就要用到<code>update</code>了。<code>update</code> 接受（至少）两个参数：第一个参数是<strong>要更新文档</strong>的限定条件，第二个是新的文档。假设决定给我们先前写的文章增加评论内容，则需要添加一个新的键：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">post.comments = [];</span><br><span class="line">db.blog.update(&#123;<span class="attr">title</span>: <span class="string">"My Blog Post"</span>&#125;, post);</span><br></pre></td></tr></table></figure>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p>remove用于将文档从数据库中永久性地删除：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.blog.remove(&#123;<span class="attr">title</span>: <span class="string">"My Blog Post"</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><code>MongoDB</code>支持将多种数据类型作为文档中的值。</p>
<h4 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h4><p><strong><code>MongoDB</code> 类似于JSON</strong> ，在概念上和<code>JavaScript</code>中的对象神似。JSON包含六种数据类型：<code>null</code>，布尔，数字，字符创，数组和对象。但是却没有日期类型、正则表达式或者函数类型。</p>
<p><code>MongoDB</code>在保留<code>JSON</code> 的基本键/值对特性的基础上，添加了一些其他的数据类型:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"x"</span>: ObjectId()&#125;</span><br><span class="line"><span class="comment">//对象ID类型</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"x"</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()&#125;</span><br><span class="line"><span class="comment">//日期类型</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"x"</span>: <span class="regexp">/foobar/i</span>&#125;</span><br><span class="line"><span class="comment">//正则表达式类型</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"x"</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*...*/</span> &#125;&#125;</span><br><span class="line"><span class="comment">//还可以包含JavaScript代码</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"x"</span>: <span class="literal">undefined</span>&#125;</span><br><span class="line"><span class="comment">//未定义类型</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"x"</span>: &#123;<span class="string">"foo"</span>: <span class="string">"bar"</span>&#125;&#125;</span><br><span class="line"><span class="comment">//内嵌文档</span></span><br></pre></td></tr></table></figure>
<h2 id="创建、更新及删除文档"><a href="#创建、更新及删除文档" class="headerlink" title="创建、更新及删除文档"></a>创建、更新及删除文档</h2><h3 id="插入并保存文档"><a href="#插入并保存文档" class="headerlink" title="插入并保存文档"></a>插入并保存文档</h3><p>利用<code>insert</code>方法来插入新的文档，这个操作会给文档增加一个<code>_id</code>键：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.foo.insert(&#123;<span class="string">"bar"</span>: <span class="string">"baz"</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>可以利用<code>remove</code>方法来清除集合中的所有文档或某些文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove();</span><br></pre></td></tr></table></figure>
<p>删除文档通常会很快，但是要清除整个集合，直接删除集合（然后重建索引）会更快：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.drop_collection(<span class="string">"bar"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><h4 id="文档替换"><a href="#文档替换" class="headerlink" title="文档替换"></a>文档替换</h4><p>更新最简单的 情况就是完全用一个新文档替代匹配的文档。这适用于模式结构发生了较大变化的时候。例如，想要将以下用户文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"joe"</span>,</span><br><span class="line">    <span class="string">"friends"</span>: <span class="number">32</span>,</span><br><span class="line">    <span class="string">"enemies"</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改变为以下文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> 	<span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"joe"</span>,</span><br><span class="line">    <span class="string">"relationships"</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"friends"</span>: <span class="number">32</span>,</span><br><span class="line">    		<span class="string">"enemies"</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用<code>update</code>来替换文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> joe = db.users.findOne(&#123;<span class="string">"name"</span>: <span class="string">"joe"</span>&#125;);</span><br><span class="line">joe.relationships = &#123;<span class="string">"friends"</span>: joe.friends, <span class="string">"enemies"</span>: joe.enemies&#125;;</span><br><span class="line">joe.username = joe.name;</span><br><span class="line"><span class="keyword">delete</span> joe.friends;</span><br><span class="line"><span class="keyword">delete</span> joe.enemies;</span><br><span class="line"><span class="keyword">delete</span> joe.name;</span><br><span class="line">db.users.update(&#123;<span class="string">"name"</span>: <span class="string">"joe&#125;, joe);</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：常见错误就是查询条件匹配了多个文档，更新时由于第二个参数的存在就会产生重复<code>_id</code> 值，数据库就会报错，然后不作出任何修改。</p>
<h4 id="使用修改器"><a href="#使用修改器" class="headerlink" title="使用修改器"></a>使用修改器</h4><p>通常文档只有一部分需要更新。利用原子的更新修改器，可以使得这部分更新极为高效。</p>
<p>假设要修改某个文档中的<code>pageviews</code>属性的值，使其加一：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.analytics.update(&#123;<span class="string">"url"</span>: <span class="string">"www.example.com"</span>&#125;, &#123;<span class="string">"$inc"</span>: &#123;<span class="string">"pageviews"</span>: <span class="number">1</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="set修改器"><a href="#set修改器" class="headerlink" title="$set修改器"></a>$set修改器</h5><p><code>$set</code> 用来指定一个键的值。如果这个键不存在，则创建它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;<span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>)&#125;, &#123;<span class="string">"$set"</span>: &#123;<span class="string">"favorite book"</span>: <span class="string">"war and peace"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>若要进行删除，可以使用<code>$unset</code>修改器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;<span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>)&#125;, &#123;<span class="string">"$unset"</span>: &#123;<span class="string">"favorite book"</span>: <span class="number">1</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="增加和减少"><a href="#增加和减少" class="headerlink" title="增加和减少"></a>增加和减少</h5><p><code>$inc</code>修改器用来增加已有键的值，或者在键不存在时创建一个键：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.games.update(&#123;<span class="string">"game"</span>: <span class="string">"pinball"</span>, <span class="string">"user"</span>: <span class="string">"joe"</span>&#125;, &#123;<span class="string">"$inc"</span>: &#123;<span class="string">"score"</span>: <span class="number">50</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="数组修改器"><a href="#数组修改器" class="headerlink" title="数组修改器"></a>数组修改器</h5><p>有一类很好的修改器可用于操作数组。如果<strong>指定的键</strong>已经存在，那么<code>$push</code> 会向已有的数组末尾加入一个元素，要是没有的话就会创建一个新的数组。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.blog.posts.findOne()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"A blog post"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若要<strong>添加一个</strong>包含一个数组的<code>comments</code><strong>键</strong> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.blog.posts.update(&#123;<span class="string">"title"</span>: <span class="string">"A blog post"</span>&#125;, &#123;<span class="attr">$push</span>: &#123;<span class="string">"comments"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"joe"</span>,</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"joe@example.com"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"nice post."</span></span><br><span class="line">&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>执行完之后，该文档变为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db.blog.posts.findOne()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"A blog post"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"..."</span>,</span><br><span class="line">    <span class="string">"comments"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"joe"</span>,</span><br><span class="line">            <span class="string">"email"</span>: <span class="string">"joe@example.com"</span>,</span><br><span class="line">            <span class="string">"content"</span>: <span class="string">"nice post."</span></span><br><span class="line">		&#125;  </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经常有这种情况，如果一个值<strong>不在数组里面</strong>就把它加进去。可以在查询文档中用<code>$ne</code> 来实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.papers.update(&#123;<span class="string">"authors cited"</span>: &#123;<span class="string">"$ne"</span> : <span class="string">"Richaie"</span>&#125;&#125;, &#123;<span class="attr">$push</span>: &#123;<span class="string">"authors cited"</span>: <span class="string">"Richa"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>同时也可以用<code>$addToSet</code>来代替<code>$ne</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;<span class="string">"title"</span>: <span class="string">"A blog post"</span>&#125;, &#123;<span class="string">"$addToSet"</span>: &#123;<span class="string">"emails"</span>: <span class="string">"joe@gmail.com"</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>但是<code>$addToSet</code>可以完成<code>$ne</code> 做不到的操作，比如 可以将<code>$addToSet</code> 和<code>$each</code> 组合起来：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(&#123;<span class="string">"title"</span>: <span class="string">"A blog post"</span>&#125;, &#123;<span class="string">"$addToSet"</span>: &#123;<span class="string">"emails"</span>: &#123;<span class="string">"$each"</span>: [<span class="string">"joe@gmail.com"</span>, <span class="string">"joe@php.net"</span>, <span class="string">"joe@python.org"</span>]&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>有几个从数组中删除元素的方法。若是把数组看成队列或者是栈，可以用<code>$pop</code> 这个修改器从数组的任意一端删除元素：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">$pop</span>: &#123;<span class="attr">key</span>: <span class="number">1</span>&#125;&#125;</span><br><span class="line"><span class="comment">//以上为从数组末尾删除元素</span></span><br><span class="line">&#123;<span class="attr">$pop</span>: &#123;<span class="attr">ket</span>: <span class="number">-1</span>&#125;&#125;</span><br><span class="line"><span class="comment">//以上为从头部删除</span></span><br></pre></td></tr></table></figure>
<p>有时需要依据特定条件来删除元素，而不仅仅是依据位置，<code>$pull</code>可以做到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.list.find()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"todo"</span>: [</span><br><span class="line">        <span class="string">"dishes"</span>,</span><br><span class="line">        <span class="string">"laundry"</span>,</span><br><span class="line">        <span class="string">"dry cleaning"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若想删除<code>todo</code> 中的某个元素：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.lists.update(&#123;&#125;, &#123;<span class="string">"$pull"</span>: &#123;<span class="string">"todo"</span>: <span class="string">"laundry"</span>&#125;&#125;);</span><br><span class="line">db.list.find()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"todo"</span>: [</span><br><span class="line">        <span class="string">"dishes"</span>,</span><br><span class="line">        <span class="string">"dry cleaning"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数组的定位修改器"><a href="#数组的定位修改器" class="headerlink" title="数组的定位修改器"></a>数组的定位修改器</h5><p>若是数组有多个值，而我们只想对其中的一部分进行操作，有两种方法操作数组中的值：通过位置或者定位操作符<code>$</code> 。</p>
<h4 id="upsert"><a href="#upsert" class="headerlink" title="upsert"></a>upsert</h4><p><code>upsert</code>是一种特殊的更新。<strong>要是没有文档符合更新条件，就会以这个条件和更新文档作为基础创建一个新文档</strong>。若是找到了，则正常更新：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.analytics.update(&#123;<span class="string">"url"</span>: <span class="string">"/blog"</span>&#125;, &#123;<span class="string">"$inc"</span>: &#123;<span class="string">"visits"</span>: <span class="number">1</span>&#125;&#125;, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//第三个参数表示是否为upsert操作</span></span><br></pre></td></tr></table></figure>
<h4 id="更新多个文档"><a href="#更新多个文档" class="headerlink" title="更新多个文档"></a>更新多个文档</h4><p>默认情况下，更新只能对符合匹配条件的第一个文档执行操作。要是有多个文档符合条件，其余的文档就没有变化。要使得所有的匹配文档都得到更新，可以设置uodate的第四个参数为true。</p>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="find简介"><a href="#find简介" class="headerlink" title="find简介"></a>find简介</h3><h4 id="指定返回的键"><a href="#指定返回的键" class="headerlink" title="指定返回的键"></a>指定返回的键</h4><p>有时候不需要将所有的键/值对都返回。遇到这种情况，可以通过<code>find</code>的<strong>第二个参数</strong>来指定想要的键：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;&#125;, &#123;<span class="string">"username"</span>: <span class="number">1</span>, <span class="string">"email"</span>: <span class="number">1</span>&#125;);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"_id"</span>: ObjectId(<span class="string">"4b2b9f67alf631733d917a7a"</span>),</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"joe"</span>,</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"joe@example.com"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//_id键总是会被返回</span></span><br></pre></td></tr></table></figure>
<p>也可以用第二个参数<strong>剔除</strong>查询结果中的某个键/值对：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;&#125;, &#123;<span class="string">"username"</span>: <span class="number">1</span>, <span class="string">"_id"</span>: <span class="number">0</span>&#125;);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"joe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查询条件"><a href="#查询条件" class="headerlink" title="查询条件"></a>查询条件</h3><h4 id="查询条件-1"><a href="#查询条件-1" class="headerlink" title="查询条件"></a>查询条件</h4><p><code>$lt</code>、<code>$lte</code> 、<code>$gt</code> 和<code>$gte</code> 就是全部的比较操作符，分别对应<code>&lt;</code> 、<code>&lt;=</code> 、<code>&gt;</code> 和<code>&gt;=</code> 。可以将其组合起来以便查找一个范围的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;<span class="string">"age"</span>: &#123;<span class="string">"$gte"</span>: <span class="number">18</span>, <span class="string">"$lte"</span>: <span class="number">30</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>对于文档的键值不等于某个特定值的情况，就要使用另一种条件操作符<code>$ne</code>了 ，它表示不相等：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;<span class="string">"username"</span>: &#123;<span class="string">"$ne"</span>: <span class="string">"joe"</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="OR查询"><a href="#OR查询" class="headerlink" title="OR查询"></a>OR查询</h4><p><code>MongoDB</code> 中有两种方式进行<code>OR</code>查询。</p>
<p><code>$in</code>非常灵活，可以指定不同的类型的条件和值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.reffle.find(&#123;<span class="string">"ticket_no"</span>: &#123;<span class="string">"$in"</span>: [<span class="number">12345</span>, <span class="string">"joe"</span>]&#125;&#125;);</span><br><span class="line"><span class="comment">//匹配"user_id"等于12345或者"joe"的文档</span></span><br></pre></td></tr></table></figure>
<p>与<code>$in</code> 相对的是<code>$nin</code> ，将返回与数组中所有条件<strong>都不匹配</strong>的文档。</p>
<p><code>$in</code>能对单个键做<code>OR</code>查询，但是要对<strong>多个键</strong>做<code>OR</code>查询的时候，应该使用<code>$or</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.reffle.find(&#123;<span class="string">"$or"</span>: [&#123;<span class="string">"ticket_no"</span>: <span class="number">725</span>&#125;, &#123;<span class="string">"winner"</span>: <span class="literal">true</span>&#125;]);</span><br></pre></td></tr></table></figure>
<p>而<code>$or</code>还可以含有其他条件语句（例如<code>$in</code>）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.reffle.find(&#123;<span class="string">"$or"</span>: [&#123;<span class="string">"ticket_no"</span>: &#123;<span class="string">"$in"</span>: [<span class="number">725</span>, <span class="number">542</span>, <span class="number">390</span>]&#125;, &#123;<span class="string">"winner"</span>: <span class="literal">true</span>&#125;]);</span><br></pre></td></tr></table></figure>
<h4 id="条件语句的规则"><a href="#条件语句的规则" class="headerlink" title="条件语句的规则"></a>条件语句的规则</h4><p>根据以上所述，可以肯定：条件句是内层文档的键，而修改器是外层文档的键。</p>
<p>一个键可以应用多个条件，但是一个键不能对应多个更新修改器。</p>
<h3 id="特定于类型的查询"><a href="#特定于类型的查询" class="headerlink" title="特定于类型的查询"></a>特定于类型的查询</h3><h4 id="null"><a href="#null" class="headerlink" title="null"></a>null</h4><p>需要<strong>注意</strong>：<code>null</code>值不仅仅匹配自身，而且匹配“不存在的”。所以，这种匹配还会返回缺少这个键的所有文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.c.find(&#123;<span class="string">"z"</span>: <span class="literal">null</span>&#125;);</span><br><span class="line"><span class="comment">//还会匹配所有不含z键值的文档</span></span><br></pre></td></tr></table></figure>
<p>如果仅仅想要匹配键值为<code>null</code>的文档，既要检查该键的值是否为<code>null</code>，还要通过<code>$exists</code>条件判定键值是否已存在：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.c.find(&#123;<span class="string">"z"</span>: &#123;<span class="string">"$in"</span>: [<span class="literal">null</span>], <span class="string">"$exists"</span>: <span class="literal">true</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>不幸的是，<strong>没有<code>$eq</code>操作符</strong>，所以看上去就有费解，但是只有一个元素的<code>$in</code> 操作符效果是一样的。</p>
<h4 id="查询数组"><a href="#查询数组" class="headerlink" title="查询数组"></a>查询数组</h4><p>如果对于以下的文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"fruit"</span>: [<span class="string">"apple"</span>, <span class="string">"banana"</span>, <span class="string">"peach"</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>用以下的查询语句将会匹配到该文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(&#123;<span class="string">"fruit"</span>: <span class="string">"banana"</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="all"><a href="#all" class="headerlink" title="$all"></a>$all</h5><p>如果要通过多个元素来匹配数组，就要使用<code>$all</code>来查询了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(<span class="string">"fruit"</span>: &#123;<span class="string">"$all"</span>: [<span class="string">"apple"</span>, <span class="string">"banana"</span>, <span class="string">"peach"</span>]&#125;);</span><br></pre></td></tr></table></figure>
<p>以上查询语句将会匹配所有拥有<code>fruit</code>键，并且键值包括这三者的文档。（不需要顺序一致）</p>
<p>绝对匹配的查询可以用一下语句：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(&#123;<span class="string">"fruit"</span>: [<span class="string">"apple"</span>, <span class="string">"banana"</span>, <span class="string">"peach"</span>]&#125;&#125;);</span><br><span class="line"><span class="comment">//不过它匹配到的文档要求这三个数组元素必须按顺序排列</span></span><br></pre></td></tr></table></figure>
<p>要是想查询数组指定位置的元素，则需要使用<code>key.index</code>语法指定下标，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(&#123;<span class="string">"fruit.2"</span>: <span class="string">"peach"</span>);</span><br></pre></td></tr></table></figure>
<h5 id="size"><a href="#size" class="headerlink" title="$size"></a>$size</h5><p><code>$size</code>可以查询指定长度的数组：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(&#123;<span class="string">"fruit"</span>: &#123;<span class="string">"$size"</span>: <span class="number">3</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="where查询"><a href="#where查询" class="headerlink" title="$where查询"></a>$where查询</h3><p>键/值对是很有力的查询方式，但是依然有些需求它无法表达。而利用<code>$where</code>子句，可以执行任意<code>JavaScript</code>作为查询的一部分。这就使得查询能做几乎任何事情。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.foo.find(&#123;<span class="string">"$where"</span>: <span class="string">"function() &#123;</span></span><br><span class="line"><span class="string">    return this.x + this.y == 10</span></span><br><span class="line"><span class="string">&#125;"</span>&#125;)</span><br><span class="line"><span class="comment">//如果函数返回true，文档就做为结果的一部分被返回；如果为false，则不然</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<code>$where</code>查询在速度上要比常规查询慢很多。</p>
<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>数据库使用游标来返回<code>find</code>的执行结果。客户端对<strong>游标的实现通常能够对最终结果进行有效的控制</strong>。</p>
<h4 id="limit、skip和sort"><a href="#limit、skip和sort" class="headerlink" title="limit、skip和sort"></a>limit、skip和sort</h4><p>最常见的查询选项就是限制返回结果的数量，忽略一定数量的结果并排序。所有这些选项一定要在查询被派发到服务器之前添加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cursor = db.stock.find(&#123;<span class="string">"desc"</span>: <span class="string">"mp3"</span>&#125;).limit(<span class="number">50</span>).skip(<span class="number">50</span>).sort(&#123;<span class="string">"price"</span>: <span class="number">-1</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>以上查询意为：查询50条<code>desc</code> 键值为<code>mp3</code> 的文档，并且跳过前<code>50</code>个然后按<code>price</code>键值降序排列后返回。</p>
<h4 id="不用skip对结果分页"><a href="#不用skip对结果分页" class="headerlink" title="不用skip对结果分页"></a>不用skip对结果分页</h4><p>最简单的分页方法就是用<code>limit</code>放回结果的第一页，然后将每个后续页面作为相对于开始的偏移量返回。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> page1 = db.foo.find(criteria).limit(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">let</span> page2 = db.foo.find(criteria).skip(<span class="number">100</span>).limit(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">let</span> page3 = db.foo.find(criteria).skip(<span class="number">200</span>).limit(<span class="number">100</span>);</span><br><span class="line"><span class="comment">//不要使用这种方法，这会导致处理很慢</span></span><br></pre></td></tr></table></figure>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引就是用来加速查询的。</p>
<h3 id="索引简介"><a href="#索引简介" class="headerlink" title="索引简介"></a>索引简介</h3><p>创建索引需要使用<code>ensureIndex</code>方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.people.ensureIndex(&#123;<span class="string">"username"</span>: <span class="number">1</span>&#125;);</span><br><span class="line"><span class="comment">//对于同一个集合，同样的索引只需要创建一次</span></span><br></pre></td></tr></table></figure>
<p>可以传递给<code>ensureIndex</code>一组值为<code>1</code>或者<code>-1</code>的键，表示索引创建的方向，通常在创建多个索引时发挥作用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.ensureIndex(&#123;<span class="string">"date"</span>: <span class="number">1</span>, <span class="string">"username"</span>: <span class="number">-1</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>创建索引的缺点就是<strong>每次插入、更新和删除</strong>时都会产生额外的开销。这是因为数据库不但需要执行这些操作，还要将这些操作在集合的索引中标记。因此，<strong>要尽可能地少创建索引</strong>。</p>
<h4 id="索引名称"><a href="#索引名称" class="headerlink" title="索引名称"></a>索引名称</h4><p>集合中的每个索引都有一个字符串类型的名字，来唯一标识索引，可以在创建索引时指定它的名字：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.foo.ensureIndex(&#123;<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">-1</span>&#125;, &#123;<span class="string">"name"</span>: <span class="string">"alphabet"</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>唯一索引可以确保集合的每一个文档的指定键都有唯一值。例如，如果想保证文档的<code>username</code>键都有不一样的值，创建一个唯一索引就好了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.people.ensureIndex(&#123;<span class="string">"username"</span>: <span class="number">1</span>&#125;, &#123;<span class="string">"unique"</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：默认情况下，<strong><code>insert</code>并不检查文档是否插入过了</strong>。所以，为了避免插入的文档中包含与唯一键重复的值，可能要用安全插入才能满足要求。</p>
<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><p><code>MongoDB</code>除了基本的查询功能，还提供了很多强大的聚合工具。</p>
<h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><p><code>count</code>是最简单的聚合工具，返回集合中的文档数量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.foo.count();</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>也可以传递查询，<code>MongoDB</code> 则会计算查询结果的数量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.foo.insert(&#123;<span class="string">"x"</span>: <span class="number">2</span>&#125;);</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h3><p><code>distinct</code> 用来找出给定键的所有不同的值。使用时必须指定集合和键，假设有以下文档：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"Ada"</span>, <span class="string">"age"</span>: <span class="number">20</span>&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"Fred"</span>, <span class="string">"age"</span>: <span class="number">35</span>&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"Susan"</span>, <span class="string">"age"</span>: <span class="number">60</span>&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>: <span class="string">"Andy"</span>, <span class="string">"age"</span>: <span class="number">35</span>&#125;</span><br></pre></td></tr></table></figure>
<p>对<code>age</code>键使用<code>distinct</code>会获得<strong>所有不同的年龄</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;<span class="string">"distinct"</span>: <span class="string">"people"</span>, <span class="string">"key"</span>: <span class="string">"age"</span>&#125;);</span><br><span class="line"><span class="comment">//将会返回如下数据：</span></span><br><span class="line">&#123;<span class="string">"value"</span>: [<span class="number">20</span>, <span class="number">35</span>, <span class="number">60</span>], <span class="string">"ok"</span>: <span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><p><code>group</code> 可以先选定分组所依据的键，而后<code>MongoDB</code>会将集合<strong>依据选定值的不同</strong>分成若干组。然后可以通过聚合每一组内的文档，产生一个结果文档。</p>
<p>例如，有一个集合存储了某只股票近30天的价格变动：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"day"</span>: <span class="string">"2010/10/03"</span>, <span class="string">"time"</span>: <span class="string">"10/3/2010 03:57:01 GMT-400"</span>, <span class="string">"price"</span>: <span class="number">4.23</span>&#125;</span><br><span class="line">&#123;<span class="string">"day"</span>: <span class="string">"2010/10/04"</span>, <span class="string">"time"</span>: <span class="string">"10/4/2010 11:28:39 GMT-400"</span>, <span class="string">"price"</span>: <span class="number">4.27</span>&#125;</span><br><span class="line">&#123;<span class="string">"day"</span>: <span class="string">"2010/10/03"</span>, <span class="string">"time"</span>: <span class="string">"10/3/2010 05:00:23 GMT-400"</span>, <span class="string">"price"</span>: <span class="number">4.10</span>&#125;</span><br><span class="line">&#123;<span class="string">"day"</span>: <span class="string">"2010/10/06"</span>, <span class="string">"time"</span>: <span class="string">"10/6/2010 05:27:58 GMT-400"</span>, <span class="string">"price"</span>: <span class="number">4.30</span>&#125;</span><br><span class="line">&#123;<span class="string">"day"</span>: <span class="string">"2010/10/04"</span>, <span class="string">"time"</span>: <span class="string">"10/4/2010 08:34:50 GMT-400"</span>, <span class="string">"price"</span>: <span class="number">4.01</span>&#125;</span><br></pre></td></tr></table></figure>
<p>通过以下操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;<span class="string">"group"</span>: &#123;</span><br><span class="line">    <span class="string">"ns"</span>: <span class="string">"stocks"</span>,</span><br><span class="line">    <span class="comment">//ns指定要进行分组的集合</span></span><br><span class="line">    <span class="string">"key"</span>: <span class="string">"day"</span>,</span><br><span class="line">    <span class="comment">//分组依据的键</span></span><br><span class="line">    <span class="string">"initial"</span>: &#123;<span class="string">"time"</span>: <span class="number">0</span>&#125;，</span><br><span class="line">    <span class="comment">//每一组reduce函数调用的初始变量</span></span><br><span class="line">    <span class="string">"$reduce"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">doc, prev</span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">if</span>(doc.time &gt; prev.time) &#123;</span><br><span class="line">    		prev.price = doc.price;</span><br><span class="line">    		prev.time = doc.time;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="string">"condition"</span>: &#123;<span class="string">"day"</span>: &#123;<span class="string">"$gt"</span>: <span class="string">"2010/09/30"</span>&#125;&#125;</span><br><span class="line">    <span class="comment">//可以限定查询条件为一个月内的价格变动</span></span><br><span class="line">&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>最后将会返回由30个文档组成的数组，每个组一个文档。如果有的文档没有依据的键，就都会被分到同一组，相应部分就会使用<code>day: null</code> 这样的形式。</p>
<h3 id="将函数作为键使用"><a href="#将函数作为键使用" class="headerlink" title="将函数作为键使用"></a>将函数作为键使用</h3><p>有些时候分组所依据的条件非常复杂，不仅是一个键，那么可以把函数作为键：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.posts.group(</span><br><span class="line">	<span class="string">"ns"</span>: <span class="string">"posts"</span>,</span><br><span class="line">    <span class="string">"$keyf"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x.category.toLowerCase();&#125;,</span><br><span class="line">    <span class="comment">//注意是$keyf</span></span><br><span class="line">    <span class="string">"initializer"</span>: ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>之后在写。</p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者: <a href="http://yoursite.com">Eric</a>
            <p>原文链接: <a href="http://yoursite.com/2018/05/12/MongoDB/">http://yoursite.com/2018/05/12/MongoDB/</a>
            <p>发表日期: <a href="http://yoursite.com/2018/05/12/MongoDB/">May 12th 2018, 8:33:30</a>
            <p>版权声明: 本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2018/05/15/ESLint-EditorConfig/" title= ESLint与EditorConfig >
                    <div class="nextTitle">ESLint与EditorConfig</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2018/04/08/new/" title= 深入理解new操作符 >
                    <div class="prevTitle">深入理解new操作符</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!--PC版-->

    <!--PC版-->


    
    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:ericy9707@foxmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/EricYeee" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/wechat.png" />
                </span>
            
        
    
        
    
        
            
                <a href="//weibo.com/p/1005055709928167/home" class="iconfont-archer weibo" target="_blank" title=weibo></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="//space.bilibili.com/11448910/" class="iconfont-archer bilibili" target="_blank" title=bilibili></a>
            
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB基础"><span class="toc-number">1.</span> <span class="toc-text">MongoDB基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#丰富的数据模型"><span class="toc-number">1.1.1.</span> <span class="toc-text">丰富的数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容易扩展"><span class="toc-number">1.1.2.</span> <span class="toc-text">容易扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#丰富的功能"><span class="toc-number">1.1.3.</span> <span class="toc-text">丰富的功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不牺牲速度"><span class="toc-number">1.1.4.</span> <span class="toc-text">不牺牲速度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#便捷的管理"><span class="toc-number">1.1.5.</span> <span class="toc-text">便捷的管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入门"><span class="toc-number">1.2.</span> <span class="toc-text">入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文档"><span class="toc-number">1.2.1.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集合"><span class="toc-number">1.2.2.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#无模式"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">无模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命名"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">命名</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#子集合"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">子集合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库"><span class="toc-number">1.2.3.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-shell"><span class="toc-number">1.2.4.</span> <span class="toc-text">MongoDB shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB客户端"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">MongoDB客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shell中的基本操作"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">shell中的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建"><span class="toc-number">1.2.4.2.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#读取"><span class="toc-number">1.2.4.2.2.</span> <span class="toc-text">读取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#更新"><span class="toc-number">1.2.4.2.3.</span> <span class="toc-text">更新</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#删除"><span class="toc-number">1.2.4.2.4.</span> <span class="toc-text">删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据类型"><span class="toc-number">1.2.5.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本数据类型"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">基本数据类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建、更新及删除文档"><span class="toc-number">1.3.</span> <span class="toc-text">创建、更新及删除文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#插入并保存文档"><span class="toc-number">1.3.1.</span> <span class="toc-text">插入并保存文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除文档"><span class="toc-number">1.3.2.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新文档"><span class="toc-number">1.3.3.</span> <span class="toc-text">更新文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#文档替换"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">文档替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用修改器"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">使用修改器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set修改器"><span class="toc-number">1.3.3.2.1.</span> <span class="toc-text">$set修改器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#增加和减少"><span class="toc-number">1.3.3.2.2.</span> <span class="toc-text">增加和减少</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#数组修改器"><span class="toc-number">1.3.3.2.3.</span> <span class="toc-text">数组修改器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#数组的定位修改器"><span class="toc-number">1.3.3.2.4.</span> <span class="toc-text">数组的定位修改器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upsert"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">upsert</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更新多个文档"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">更新多个文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询"><span class="toc-number">1.4.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#find简介"><span class="toc-number">1.4.1.</span> <span class="toc-text">find简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#指定返回的键"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">指定返回的键</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询条件"><span class="toc-number">1.4.2.</span> <span class="toc-text">查询条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查询条件-1"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">查询条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OR查询"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">OR查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#条件语句的规则"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">条件语句的规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#特定于类型的查询"><span class="toc-number">1.4.3.</span> <span class="toc-text">特定于类型的查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询数组"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">查询数组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#all"><span class="toc-number">1.4.3.2.1.</span> <span class="toc-text">$all</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#size"><span class="toc-number">1.4.3.2.2.</span> <span class="toc-text">$size</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#where查询"><span class="toc-number">1.4.4.</span> <span class="toc-text">$where查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#游标"><span class="toc-number">1.4.5.</span> <span class="toc-text">游标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#limit、skip和sort"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">limit、skip和sort</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#不用skip对结果分页"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">不用skip对结果分页</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引"><span class="toc-number">1.5.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#索引简介"><span class="toc-number">1.5.1.</span> <span class="toc-text">索引简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#索引名称"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">索引名称</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#唯一索引"><span class="toc-number">1.5.2.</span> <span class="toc-text">唯一索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#聚合"><span class="toc-number">1.6.</span> <span class="toc-text">聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#count"><span class="toc-number">1.6.1.</span> <span class="toc-text">count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#distinct"><span class="toc-number">1.6.2.</span> <span class="toc-text">distinct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group"><span class="toc-number">1.6.3.</span> <span class="toc-text">group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将函数作为键使用"><span class="toc-number">1.6.4.</span> <span class="toc-text">将函数作为键使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.7.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-archive"> Total : 38 </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/18</span><a class="archive-post-title" href= "/2018/06/18/UDKjs(2)/" >你不知道的JavaScript读书笔记(2)</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/17</span><a class="archive-post-title" href= "/2018/06/17/UDKjs(1)/" >你不知道的JavaScript读书笔记(1)</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span><a class="archive-post-title" href= "/2018/05/30/meta/" >HTML中的meta标签</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span><a class="archive-post-title" href= "/2018/05/30/rem/" >利用rem进行适配</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span><a class="archive-post-title" href= "/2018/05/27/webpack/" >深入浅出webpack学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span><a class="archive-post-title" href= "/2018/05/21/git/" >GIT使用手册</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span><a class="archive-post-title" href= "/2018/05/21/mongoose/" >Mongoose入门指南</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/18</span><a class="archive-post-title" href= "/2018/05/18/Express/" >Express入门指南</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/15</span><a class="archive-post-title" href= "/2018/05/15/ESLint-EditorConfig/" >ESLint与EditorConfig</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/15</span><a class="archive-post-title" href= "/2018/05/15/config-lite/" >config-lite</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/12</span><a class="archive-post-title" href= "/2018/05/12/MongoDB/" >MongoDB基础</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/08</span><a class="archive-post-title" href= "/2018/04/08/Call/" >Call,aplly与bind</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/08</span><a class="archive-post-title" href= "/2018/04/08/new/" >深入理解new操作符</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span><a class="archive-post-title" href= "/2018/04/05/flex/" >Flex布局</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span><a class="archive-post-title" href= "/2018/04/05/scrollTop/" >scrollTop等元素距离</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span><a class="archive-post-title" href= "/2018/04/02/Event Loop/" >Event Loop</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2018/04/01/数组去重的方法/" >数组去重</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2018/04/01/深浅拷贝/" >深浅拷贝</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2018/04/01/回流和重绘/" >重绘和回流</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/25</span><a class="archive-post-title" href= "/2018/03/25/多栏布局/" >多栏布局</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/24</span><a class="archive-post-title" href= "/2018/03/24/隐藏元素的方法/" >隐藏页面元素的方法</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/21</span><a class="archive-post-title" href= "/2018/03/21/cookie与WebStorage/" >cookie与WebStorage</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/21</span><a class="archive-post-title" href= "/2018/03/21/清除浮动/" >清除浮动</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/16</span><a class="archive-post-title" href= "/2018/03/16/DNS详解/" >DNS详解</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/08</span><a class="archive-post-title" href= "/2018/03/08/Ajax/" >JS中的Ajax</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span><a class="archive-post-title" href= "/2018/03/07/ES6/" >ES6学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/15</span><a class="archive-post-title" href= "/2018/02/15/typesOfJs/" >JS中的数据类型与操作符</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/15</span><a class="archive-post-title" href= "/2018/02/15/src与href/" >src与href的区别</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span><a class="archive-post-title" href= "/2018/02/08/FetchAPI/" >Fetch API学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span><a class="archive-post-title" href= "/2018/02/08/CodeIgniter-Rest-Server/" >CodeIgniter Rest Server 学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/06</span><a class="archive-post-title" href= "/2018/02/06/RESTful/" >RESTful学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/05</span><a class="archive-post-title" href= "/2018/02/05/CodeIgniter/" >CodeIgniter学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/02</span><a class="archive-post-title" href= "/2018/02/02/less/" >less学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/20</span><a class="archive-post-title" href= "/2018/01/20/sass/" >SASS学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span><a class="archive-post-title" href= "/2018/01/19/keep-alive/" >vue2.0中keep-alive实践</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/19</span><a class="archive-post-title" href= "/2018/01/19/SVG/" >SVG学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/12</span><a class="archive-post-title" href= "/2018/01/12/css中的层叠./" >CSS中的层叠</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/27</span><a class="archive-post-title" href= "/2017/12/27/webpackAsync/" >webpack异步加载原理</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="JavaScript"><span class="iconfont-archer">&#xe606;</span>JavaScript</span>
    
        <span class="sidebar-tag-name" data-tags="JavaScript ajax"><span class="iconfont-archer">&#xe606;</span>JavaScript ajax</span>
    
        <span class="sidebar-tag-name" data-tags="DNS"><span class="iconfont-archer">&#xe606;</span>DNS</span>
    
        <span class="sidebar-tag-name" data-tags="CodeIgniter"><span class="iconfont-archer">&#xe606;</span>CodeIgniter</span>
    
        <span class="sidebar-tag-name" data-tags="PHP"><span class="iconfont-archer">&#xe606;</span>PHP</span>
    
        <span class="sidebar-tag-name" data-tags="ES6"><span class="iconfont-archer">&#xe606;</span>ES6</span>
    
        <span class="sidebar-tag-name" data-tags="NodeJS"><span class="iconfont-archer">&#xe606;</span>NodeJS</span>
    
        <span class="sidebar-tag-name" data-tags="express"><span class="iconfont-archer">&#xe606;</span>express</span>
    
        <span class="sidebar-tag-name" data-tags="RESTful"><span class="iconfont-archer">&#xe606;</span>RESTful</span>
    
        <span class="sidebar-tag-name" data-tags="ESLint"><span class="iconfont-archer">&#xe606;</span>ESLint</span>
    
        <span class="sidebar-tag-name" data-tags="CSS"><span class="iconfont-archer">&#xe606;</span>CSS</span>
    
        <span class="sidebar-tag-name" data-tags="SVG"><span class="iconfont-archer">&#xe606;</span>SVG</span>
    
        <span class="sidebar-tag-name" data-tags="Flex"><span class="iconfont-archer">&#xe606;</span>Flex</span>
    
        <span class="sidebar-tag-name" data-tags="Git"><span class="iconfont-archer">&#xe606;</span>Git</span>
    
        <span class="sidebar-tag-name" data-tags="Less"><span class="iconfont-archer">&#xe606;</span>Less</span>
    
        <span class="sidebar-tag-name" data-tags="Vue"><span class="iconfont-archer">&#xe606;</span>Vue</span>
    
        <span class="sidebar-tag-name" data-tags="MongoDB"><span class="iconfont-archer">&#xe606;</span>MongoDB</span>
    
        <span class="sidebar-tag-name" data-tags="HTML"><span class="iconfont-archer">&#xe606;</span>HTML</span>
    
        <span class="sidebar-tag-name" data-tags="Sass"><span class="iconfont-archer">&#xe606;</span>Sass</span>
    
        <span class="sidebar-tag-name" data-tags="Scss"><span class="iconfont-archer">&#xe606;</span>Scss</span>
    
        <span class="sidebar-tag-name" data-tags="webpack"><span class="iconfont-archer">&#xe606;</span>webpack</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: false</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: '/',
        author: 'Eric'
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- busuanzi  -->
    
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
    
    </body>
</html>


